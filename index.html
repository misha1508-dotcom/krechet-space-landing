<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏—Ö–∞–∏–ª | –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</title>
    <meta name="description" content="–ö–æ–ª–ª–µ–∫—Ü–∏—è –ø–æ–ª–µ–∑–Ω—ã—Ö –≤–µ–±-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –æ—Ç –ú–∏—Ö–∞–∏–ª–∞">
    <meta property="og:title" content="–ú–∏—Ö–∞–∏–ª | –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã">
    <meta property="og:description" content="–ö–æ–ª–ª–µ–∫—Ü–∏—è –ø–æ–ª–µ–∑–Ω—ã—Ö –≤–µ–±-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ru_RU">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶Ö</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #f8fafc;
            --text: #1e293b;
            --muted: #64748b;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --accent: #f59e0b;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f172a;
                --text: #f1f5f9;
                --muted: #94a3b8;
                --card-bg: #1e293b;
                --border: #334155;
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2.5rem 1.5rem;
        }

        /* Header */
        .header { text-align: center; margin-bottom: 2rem; }
        .header h1 { font-size: 2.25rem; font-weight: 700; margin-bottom: 0.4rem; }
        .header p { color: var(--muted); font-size: 1.05rem; }

        /* Promo */
        .promo-section {
            max-width: 420px;
            margin: 0 auto 2.5rem;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.25rem;
        }
        .promo-input-group { display: flex; gap: 0.5rem; }
        .promo-input {
            flex: 1;
            padding: 0.7rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 0.95rem;
            background: var(--bg);
            color: var(--text);
            outline: none;
        }
        .promo-input:focus { border-color: var(--accent); }
        .promo-button {
            padding: 0.7rem 1.25rem;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white; border: none; border-radius: 0.5rem;
            font-weight: 600; cursor: pointer;
            transition: transform 0.15s; font-size: 0.95rem;
        }
        .promo-button:hover { transform: scale(1.04); }
        .promo-button:disabled { opacity: 0.5; cursor: default; transform: none; }
        .access-badge {
            display: inline-flex; align-items: center; gap: 0.4rem;
            padding: 0.4rem 0.9rem;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white; border-radius: 9999px;
            font-size: 0.8rem; font-weight: 600; margin-top: 0.75rem;
        }

        /* Grid */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.25rem;
        }

        /* Card */
        .project-card {
            aspect-ratio: 1;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            cursor: pointer;
        }
        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px -8px rgba(0,0,0,0.15);
        }

        /* Per-card lock */
        .project-card.vip-locked {
            cursor: default;
            opacity: 0.7;
        }
        .project-card.vip-locked:hover {
            transform: none;
            box-shadow: none;
        }
        .project-card.vip-locked .card-inner {
            filter: blur(6px);
            user-select: none;
        }
        .card-lock {
            display: none;
            position: absolute;
            inset: 0;
            align-items: center;
            justify-content: center;
            z-index: 3;
            border-radius: 1.5rem;
        }
        .card-lock span {
            font-size: 2.2rem;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.15));
        }
        .project-card.vip-locked .card-lock {
            display: flex;
        }

        .card-inner {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: filter 0.3s;
        }

        /* Icon */
        .card-icon {
            width: 56px; height: 56px;
            border-radius: 0.875rem;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.75rem; flex-shrink: 0;
        }

        /* Access toggle (top-left, VIP only) */
        .access-toggle {
            position: absolute;
            top: 0.75rem; left: 0.75rem;
            width: 34px; height: 34px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            z-index: 5;
            transition: transform 0.15s, background 0.15s, border-color 0.15s;
        }
        .access-toggle:hover { transform: scale(1.12); }
        .access-toggle.is-free {
            background: #d1fae5;
            border-color: #10b981;
        }
        @media (prefers-color-scheme: dark) {
            .access-toggle.is-free {
                background: #064e3b;
                border-color: #10b981;
            }
        }

        /* Drag handle (top-right, VIP only) */
        .drag-handle {
            position: absolute;
            top: 0.75rem; right: 0.75rem;
            width: 32px; height: 32px;
            border-radius: 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            cursor: grab;
            font-size: 1rem; color: var(--muted);
            touch-action: none;
            z-index: 5;
            transition: background 0.15s;
        }
        .drag-handle:hover { background: var(--border); }
        .drag-handle:active { cursor: grabbing; }

        .card-title {
            font-size: 1.2rem; font-weight: 700;
            margin-top: 1rem; line-height: 1.3;
        }
        .card-desc {
            color: var(--muted); font-size: 0.85rem;
            margin-top: 0.5rem; flex: 1; overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        .card-tags {
            display: flex; flex-wrap: wrap; gap: 0.4rem;
            margin-top: auto; padding-top: 0.75rem;
        }
        .tag {
            font-size: 0.7rem; padding: 0.2rem 0.6rem;
            border-radius: 9999px; font-weight: 500;
        }
        .tag-free {
            background: rgba(16, 185, 129, 0.15);
            color: #059669;
        }
        .tag-vip {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        /* Drag states */
        .drag-clone {
            position: fixed; z-index: 9999;
            pointer-events: none; opacity: 0.9;
            transform: rotate(2deg) scale(1.03);
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.3);
            border-radius: 1.5rem;
        }
        .drag-placeholder {
            aspect-ratio: 1;
            border: 2px dashed var(--border);
            border-radius: 1.5rem;
            background: transparent;
            min-height: 100px;
        }

        /* Footer */
        .footer {
            text-align: center; margin-top: 3rem;
            padding-top: 1.5rem; border-top: 1px solid var(--border);
        }
        .footer a {
            color: var(--muted); text-decoration: none;
            display: inline-flex; align-items: center; gap: 0.5rem;
            transition: color 0.2s;
        }
        .footer a:hover { color: var(--text); }
        .footer svg { width: 20px; height: 20px; }

        /* Empty state for non-VIP with no free projects */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--muted);
        }
        .empty-state .empty-icon { font-size: 3rem; margin-bottom: 0.75rem; }
        .empty-state p { font-size: 1rem; }

        @media (max-width: 580px) {
            .header h1 { font-size: 1.75rem; }
            .projects-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
            .card-inner { padding: 1rem; }
            .card-icon { width: 44px; height: 44px; font-size: 1.35rem; border-radius: 0.7rem; }
            .card-title { font-size: 0.95rem; margin-top: 0.6rem; }
            .card-desc { font-size: 0.75rem; -webkit-line-clamp: 2; }
            .tag { font-size: 0.6rem; padding: 0.15rem 0.45rem; }
            .drag-handle { width: 26px; height: 26px; font-size: 0.8rem; top: 0.5rem; right: 0.5rem; }
            .access-toggle { width: 28px; height: 28px; font-size: 0.85rem; top: 0.5rem; left: 0.5rem; border-radius: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>–ü—Ä–æ–µ–∫—Ç—ã –ú–∏—Ö–∞–∏–ª–∞</h1>
            <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–Ω—è—Ç—å —Å–µ–±—è –∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä—É—Ç–∏–Ω—É</p>
        </header>

        <div class="promo-section" id="promoSection">
            <div class="promo-input-group">
                <input type="text" class="promo-input" id="promoInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞">
                <button class="promo-button" id="promoBtn" onclick="applyPromo()">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
            <div id="accessBadge" style="display:none">
                <span class="access-badge">&#10024; VIP-–¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</span>
            </div>
        </div>

        <div class="projects-grid" id="projectsGrid"></div>

        <footer class="footer">
            <a href="https://t.me/krechet_mike" target="_blank" rel="noopener noreferrer">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                @krechet_mike
            </a>
        </footer>
    </div>

<script>
const PROJECTS = [
    {
        id: 'inversion',
        title: '–ò–Ω–≤–µ—Ä—Å–∏—è',
        desc: '–ù–µ–π—Ä–æ—Å–µ—Ç—å –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ç–≤–æ–∏ –ø—Ä–æ–≤–∞–ª—ã –≤ –∫–∞—Ä—Ç—É —Å–∏–ª—å–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω',
        url: '/inversion/',
        emoji: '\u{1F504}',
        gradient: 'linear-gradient(135deg, #10b981, #34d399)',
        tagColor: '#10b981',
        tags: ['AI-–∞–Ω–∞–ª–∏–∑', '–°–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ']
    },
    {
        id: 'tochka',
        title: '–¢–æ—á–∫–∞ –°–±–æ—Ä–∫–∏',
        desc: '10+ —Å–∏—Å—Ç–µ–º —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. AI –Ω–∞—Ö–æ–¥–∏—Ç —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è',
        url: '/assemblage/',
        emoji: '\u{1F3AF}',
        gradient: 'linear-gradient(135deg, #7c3aed, #ec4899)',
        tagColor: '#7c3aed',
        tags: ['AI-—Å–∏–Ω—Ç–µ–∑', '–°–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ']
    },
    {
        id: 'kp-calculator',
        title: '–ö–ü –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä',
        desc: '–†–∞—Å—á—ë—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –≥–æ—Å–∑–∞–∫—É–ø–æ–∫ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤',
        url: '/kp-calculator/',
        emoji: '\u{1F9EE}',
        gradient: 'linear-gradient(135deg, #f97316, #ea580c)',
        tagColor: '#f97316',
        tags: ['–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä', '–ì–æ—Å–∑–∞–∫—É–ø–∫–∏']
    },
    {
        id: 'virtual-barber',
        title: 'Virtual Barber',
        desc: 'AI-–ø—Ä–µ–≤—å—é –Ω–æ–≤–æ–π –ø—Ä–∏—á—ë—Å–∫–∏. –ó–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ \u2014 —É–≤–∏–¥—å —Å–µ–±—è —Å –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∏–∂–∫–æ–π',
        url: '/virtual-barber/',
        emoji: '\u{1F488}',
        gradient: 'linear-gradient(135deg, #14b8a6, #0d9488)',
        tagColor: '#14b8a6',
        tags: ['AI', '–°—Ç–∏–ª—å']
    },
    {
        id: 'wildberries',
        title: '–ê–∫—Ç—ã Wildberries',
        desc: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–∫—Ç–æ–≤ –ø—Ä–∏—ë–º–∞ –∏ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ –∏–∑ XLSX —Ñ–∞–π–ª–æ–≤',
        url: '/wildberries-acts/',
        emoji: '\u{1F4C4}',
        gradient: 'linear-gradient(135deg, #667eea, #764ba2)',
        tagColor: '#667eea',
        tags: ['–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è', 'WB']
    },
    {
        id: 'yogurt-calc',
        title: '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –π–æ–≥—É—Ä—Ç–∞',
        desc: '–Æ–Ω–∏—Ç-—ç–∫–æ–Ω–æ–º–∏–∫–∞ –∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –π–æ–≥—É—Ä—Ç–∞',
        url: '/yogurt-calc/',
        emoji: '\u{1F95B}',
        gradient: 'linear-gradient(135deg, #f093fb, #f5576c)',
        tagColor: '#f5576c',
        tags: ['–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä', '–ë–∏–∑–Ω–µ—Å']
    },
    {
        id: 'yogurt-financial',
        title: '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –º–æ–¥–µ–ª—å',
        desc: 'P&L, —Ç–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –π–æ–≥—É—Ä—Ç–æ–≤–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞',
        url: '/yogurt-financial/',
        emoji: '\u{1F4CA}',
        gradient: 'linear-gradient(135deg, #f59e0b, #d97706)',
        tagColor: '#d97706',
        tags: ['–§–∏–Ω–∞–Ω—Å—ã', '–ë–∏–∑–Ω–µ—Å']
    },
    {
        id: 'nparggu',
        title: '–ù–ü–ê –†–ì–ì–£',
        desc: 'AI-—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã—Ö –∞–∫—Ç–æ–≤ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –†–ì–ì–£',
        url: '/nparggu',
        emoji: '\u{2696}\u{FE0F}',
        gradient: 'linear-gradient(135deg, #3b82f6, #06b6d4)',
        tagColor: '#3b82f6',
        tags: ['–ê–Ω–∞–ª–∏–∑', '–ü—Ä–∞–≤–æ']
    },
    {
        id: 'date-planner',
        title: '–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å–≤–∏–¥–∞–Ω–∏–π',
        desc: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è —Å–≤–∏–¥–∞–Ω–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –±—é–¥–∂–µ—Ç—É',
        url: '/date-planner/',
        emoji: '\u{1F49D}',
        gradient: 'linear-gradient(135deg, #ec4899, #f43f5e)',
        tagColor: '#ec4899',
        tags: ['–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', '–û—Ç–Ω–æ—à–µ–Ω–∏—è']
    },
    {
        id: 'promotest',
        title: '–í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞',
        desc: 'AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å —ç—Ç–∏–∫–µ—Ç–∫–æ–π –Ω–∞ –ª—é–±–æ–º —Ñ–æ–Ω–µ',
        url: '/promotest/',
        emoji: '\u{1F5BC}\u{FE0F}',
        gradient: 'linear-gradient(135deg, #8b5cf6, #a855f7)',
        tagColor: '#8b5cf6',
        tags: ['AI', '–î–∏–∑–∞–π–Ω']
    },
    {
        id: 'pdf',
        title: 'PDF \u2192 Word',
        desc: '–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π Word —Ñ–æ—Ä–º–∞—Ç',
        url: '/pdf/',
        emoji: '\u{1F4D1}',
        gradient: 'linear-gradient(135deg, #ef4444, #dc2626)',
        tagColor: '#ef4444',
        tags: ['–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä', '–î–æ–∫—É–º–µ–Ω—Ç—ã']
    },
    {
        id: 'training-diary',
        title: '–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫',
        desc: '–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å AI-–∞–Ω–∞–ª–∏–∑–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞',
        url: '/training/',
        emoji: '\u{1F4AA}',
        gradient: 'linear-gradient(135deg, #16a34a, #22c55e)',
        tagColor: '#16a34a',
        tags: ['–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏', '–ó–¥–æ—Ä–æ–≤—å–µ']
    }
];

const VIP_KEY = 'VIP';
const STORAGE_VIP = 'vipAccess';

const grid = document.getElementById('projectsGrid');
let isVIP = false;

// ‚îÄ‚îÄ Server config (shared across all visitors) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let config = { free: [], order: [] };

async function loadConfig() {
    try {
        const res = await fetch('/api/config');
        if (res.ok) config = await res.json();
    } catch (e) { /* use defaults */ }
}

async function saveConfig(updates) {
    try {
        await fetch('/api/config', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ key: VIP_KEY, ...updates })
        });
    } catch (e) {
        console.error('Config save failed:', e);
    }
}

// ‚îÄ‚îÄ Access toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function toggleAccess(projectId) {
    const freeSet = new Set(config.free || []);
    if (freeSet.has(projectId)) {
        freeSet.delete(projectId);
    } else {
        freeSet.add(projectId);
    }
    config.free = [...freeSet];
    renderCards();
    await saveConfig({ free: config.free });
}

// ‚îÄ‚îÄ Order ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveOrder() {
    const ids = [...grid.querySelectorAll('.project-card')].map(c => c.dataset.id);
    config.order = ids;
    saveConfig({ order: ids });
}

function getOrderedProjects() {
    const saved = config.order || [];
    if (!saved.length) return [...PROJECTS];
    const map = Object.fromEntries(PROJECTS.map(p => [p.id, p]));
    const ordered = saved.filter(id => map[id]).map(id => map[id]);
    PROJECTS.forEach(p => { if (!saved.includes(p.id)) ordered.push(p); });
    return ordered;
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCards() {
    grid.innerHTML = '';
    const projects = getOrderedProjects();
    const freeSet = new Set(config.free || []);

    projects.forEach(p => {
        const isFree = freeSet.has(p.id);
        const isLocked = !isFree && !isVIP;

        const card = document.createElement('div');
        card.className = 'project-card' + (isLocked ? ' vip-locked' : '');
        card.dataset.id = p.id;

        // Navigate on card click (skip if clicking toggle or drag handle)
        card.addEventListener('click', (e) => {
            if (e.target.closest('.access-toggle') || e.target.closest('.drag-handle')) return;
            if (isLocked) return;
            window.location.href = p.url;
        });

        // Build inner HTML
        let html = '';

        // Access toggle (VIP admin only)
        if (isVIP) {
            html += `<div class="access-toggle ${isFree ? 'is-free' : ''}"
                data-pid="${p.id}"
                title="${isFree ? '–°–¥–µ–ª–∞—Ç—å VIP (–∑–∞–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø)' : '–°–¥–µ–ª–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º (–æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø)'}">
                ${isFree ? '\u{1F513}' : '\u{1F512}'}
            </div>`;
        }

        // Drag handle (VIP only)
        if (isVIP) {
            html += '<div class="drag-handle" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ">&#x2630;</div>';
        }

        // Lock overlay for non-VIP on VIP cards
        if (isLocked) {
            html += '<div class="card-lock"><span>\u{1F512}</span></div>';
        }

        // Access status tag
        const accessTag = isFree
            ? '<span class="tag tag-free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>'
            : '<span class="tag tag-vip">VIP</span>';

        html += `
            <div class="card-inner">
                <div class="card-icon" style="background:${p.gradient}">${p.emoji}</div>
                <div class="card-title">${p.title}</div>
                <div class="card-desc">${p.desc}</div>
                <div class="card-tags">
                    ${accessTag}
                    ${p.tags.map(t => `<span class="tag" style="background:${p.tagColor}18;color:${p.tagColor}">${t}</span>`).join('')}
                </div>
            </div>`;

        card.innerHTML = html;
        grid.appendChild(card);
    });

    // Event delegation for access toggles
    grid.querySelectorAll('.access-toggle').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleAccess(btn.dataset.pid);
        });
    });

    if (isVIP) initDragAndDrop();
}

// ‚îÄ‚îÄ VIP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applyPromo() {
    const input = document.getElementById('promoInput');
    if (input.value.trim().toUpperCase() === VIP_KEY) {
        localStorage.setItem(STORAGE_VIP, 'true');
        activateVIP();
        input.value = '';
    } else {
        input.style.borderColor = '#ef4444';
        setTimeout(() => { input.style.borderColor = ''; }, 1200);
    }
}

function activateVIP() {
    isVIP = true;
    document.getElementById('accessBadge').style.display = 'block';
    document.getElementById('promoInput').disabled = true;
    document.getElementById('promoBtn').disabled = true;
    renderCards();
}

function checkAccess() {
    if (localStorage.getItem(STORAGE_VIP) === 'true') {
        activateVIP();
    } else {
        renderCards();
    }
}

document.getElementById('promoInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') applyPromo();
});

// ‚îÄ‚îÄ Drag & Drop (pointer events) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let drag = null;

function initDragAndDrop() {
    grid.querySelectorAll('.drag-handle').forEach(handle => {
        handle.addEventListener('pointerdown', onDragStart);
    });
}

function onDragStart(e) {
    const handle = e.currentTarget;
    const card = handle.closest('.project-card');
    if (!card) return;

    e.preventDefault();
    handle.setPointerCapture(e.pointerId);

    const rect = card.getBoundingClientRect();
    drag = {
        card, pointerId: e.pointerId,
        offsetX: e.clientX - rect.left,
        offsetY: e.clientY - rect.top,
        width: rect.width, height: rect.height,
        startX: e.clientX, startY: e.clientY,
        moved: false, clone: null, placeholder: null
    };

    handle.addEventListener('pointermove', onDragMove);
    handle.addEventListener('pointerup', onDragEnd);
    handle.addEventListener('pointercancel', onDragEnd);
}

function onDragMove(e) {
    if (!drag) return;
    const dx = e.clientX - drag.startX;
    const dy = e.clientY - drag.startY;

    if (!drag.moved && Math.abs(dx) < 5 && Math.abs(dy) < 5) return;

    if (!drag.moved) {
        drag.moved = true;
        drag.card.style.pointerEvents = 'none';

        drag.clone = drag.card.cloneNode(true);
        drag.clone.className = 'project-card drag-clone';
        drag.clone.style.width = drag.width + 'px';
        drag.clone.style.height = drag.height + 'px';
        document.body.appendChild(drag.clone);

        drag.placeholder = document.createElement('div');
        drag.placeholder.className = 'drag-placeholder';
        grid.insertBefore(drag.placeholder, drag.card);
        drag.card.style.display = 'none';
    }

    drag.clone.style.left = (e.clientX - drag.offsetX) + 'px';
    drag.clone.style.top = (e.clientY - drag.offsetY) + 'px';

    const cards = [...grid.querySelectorAll('.project-card:not([style*="display: none"])')];
    for (const c of cards) {
        const r = c.getBoundingClientRect();
        if (e.clientX > r.left && e.clientX < r.right && e.clientY > r.top && e.clientY < r.bottom) {
            if (e.clientY > r.top + r.height / 2) {
                grid.insertBefore(drag.placeholder, c.nextSibling);
            } else {
                grid.insertBefore(drag.placeholder, c);
            }
            break;
        }
    }
}

function onDragEnd(e) {
    if (!drag) return;
    const handle = e.currentTarget;
    handle.removeEventListener('pointermove', onDragMove);
    handle.removeEventListener('pointerup', onDragEnd);
    handle.removeEventListener('pointercancel', onDragEnd);

    if (drag.moved) {
        grid.insertBefore(drag.card, drag.placeholder);
        drag.card.style.display = '';
        drag.card.style.pointerEvents = '';
        drag.placeholder.remove();
        drag.clone.remove();
        saveOrder();
    }
    drag = null;
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function init() {
    await loadConfig();
    checkAccess();
}
init();
</script>
</body>
</html>
